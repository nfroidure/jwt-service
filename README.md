[//]: # ( )
[//]: # (This file is automatically generated by a `metapak`)
[//]: # (module. Do not change it  except between the)
[//]: # (`content:start/end` flags, your changes would)
[//]: # (be overridden.)
[//]: # ( )
# jwt-service
> A simple wrapper for a simpler JWT surface API

[![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg)](https://github.com/nfroidure/jwt-service/blob/master/LICENSE)
[![Coverage Status](https://coveralls.io/repos/github/nfroidure/jwt-service/badge.svg?branch=master)](https://coveralls.io/github/nfroidure/jwt-service?branch=master)


[//]: # (::contents:start)

This wrapper is directly usable with
[Knifecycle](https://github.com/nfroidure/knifecycle).

## Overriding

Let's say you wanna create a sub-service of this one with custom inputs, for
say, refresh tokens in a [Whook](https://github.com/nfroidure/whook) project,
here is how you would do:

```ts
import initJWT, { JWTServiceConfig } from 'jwt_service';
import { inject } from 'knifecycle';

export type RefreshJWTServiceConfig = {
  ENV: JWTServiceConfig['ENV'];
  REFRESH_JWT_SECRET_ENV_NAME: JWTServiceConfig['JWT_SECRET_ENV_NAME'];
  REFRESH_JWT: JWTServiceConfig['JWT'];
};

export default inject(
  [
    '?JWT_SECRET_ENV_NAME>REFRESH_JWT_SECRET_ENV_NAME',
    'JWT>REFRESH_JWT',
    '?ENV',
    '?log',
    '?time',
  ],
  initJWT,
);
```

[//]: # (::contents:end)

# API
## Functions

<dl>
<dt><a href="#initJWT">initJWT(services)</a> ⇒ <code><a href="#JWTService">Promise.&lt;JWTService&gt;</a></code></dt>
<dd><p>Instantiate the JWT service</p>
</dd>
</dl>

## Typedefs

<dl>
<dt><a href="#JWTService">JWTService</a></dt>
<dd></dd>
</dl>

<a name="initJWT"></a>

## initJWT(services) ⇒ [<code>Promise.&lt;JWTService&gt;</code>](#JWTService)
Instantiate the JWT service

**Kind**: global function  
**Returns**: [<code>Promise.&lt;JWTService&gt;</code>](#JWTService) - A promise of the jwt service  

| Param | Type | Description |
| --- | --- | --- |
| services | <code>Object</code> | The services to inject |
| [services.JWT_SECRET_ENV_NAME] | <code>function</code> | The environment variable name in which to pick-up the  JWT secret |
| [services.ENV] | <code>Object</code> | An environment object |
| services.JWT | <code>function</code> | The JWT service configuration object |
| [services.log] | <code>function</code> | A logging function |
| [services.time] | <code>function</code> | A function returning the current timestamp |

**Example**  
```js
import initJWTService from 'jwt-service';

const jwt = await initJWTService({
  JWT: {
    secret: 'secret',
    duration: '2d',
    tolerance: '2h',
    algorithms: ['HS256'],
  },
  log: console.log.bind(console),
  time: Date.now.bind(Date),
});

const token = await jwt.sign({ my: 'payload' });
```
<a name="JWTService"></a>

## JWTService
**Kind**: global typedef  

* [JWTService](#JWTService)
    * [.sign(payload, [algorithm])](#JWTService.sign) ⇒ <code>Promise.&lt;JWTSignResult&gt;</code>
    * [.verify([token])](#JWTService.verify) ⇒ <code>Promise.&lt;Object&gt;</code>

<a name="JWTService.sign"></a>

### JWTService.sign(payload, [algorithm]) ⇒ <code>Promise.&lt;JWTSignResult&gt;</code>
Sign the given payload

**Kind**: static method of [<code>JWTService</code>](#JWTService)  
**Returns**: <code>Promise.&lt;JWTSignResult&gt;</code> - A promise to be resolved with the signed token.  

| Param | Type | Description |
| --- | --- | --- |
| payload | <code>Object</code> | The payload to sign |
| [algorithm] | <code>String</code> | The signing algorithm |

**Example**  
```js
const token = await jwt.sign({ my: 'payload' });
```
<a name="JWTService.verify"></a>

### JWTService.verify([token]) ⇒ <code>Promise.&lt;Object&gt;</code>
Verify and decode the given token

**Kind**: static method of [<code>JWTService</code>](#JWTService)  
**Returns**: <code>Promise.&lt;Object&gt;</code> - A promise to be resolved with the token payload.  

| Param | Type | Description |
| --- | --- | --- |
| [token] | <code>String</code> | The token to decode |

**Example**  
```js
const payload = await jwt.verify('my.jwt.token');
```

# Authors
- [Nicolas Froidure](https://insertafter.com/en/index.html)

# License
[MIT](https://github.com/nfroidure/jwt-service/blob/master/LICENSE)
